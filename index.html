<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CrewTech Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./styles.css" />
  <script src="./script.js" defer></script>
  <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
</head>
<body>
  <!-- Splash / loading screen -->
  <div id="splash-overlay">
    <div class="splash-inner">
      <div class="logo-shine-wrap">
        <img src="crewtech_logo.png" alt="CrewTech logo" class="splash-logo" />
      </div>
      <p class="splash-caption">Loading your crew…</p>
    </div>
  </div>

  <div class="page">
    <header>
      <div class="header-logo-only">
        <img src="crewtech_logo.png" alt="CrewTech logo" class="logo" />
      </div>
      <p class="tagline">Your crew, your time, your tool.</p>
    </header>

    <!-- Add Job / Shifts -->
    <section class="section" id="add-job-section">
      <h2 id="add-job-toggle" role="button" tabindex="0" aria-expanded="false" title="Show/Hide">
        <span class="icon-wrap">
<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
  <circle cx="12" cy="12" r="10" stroke="#d1d5db" fill="white"/>
  <line x1="12" y1="8" x2="12" y2="16"/>
  <line x1="8" y1="12" x2="16" y2="12"/>
</svg>
</span>

        <span>Add Job / Shifts</span>
        <span class="caret" aria-hidden="true">▸</span>
      </h2>

      <!-- FULL WRAPPER (collapsible card) -->
      <div id="add-job-full-body" style="display:none; margin-top:0.5rem;">

        <p>Paste the text your boss sends you, or fill the fields manually. Workers will only see their own shifts.</p>

        <!-- 0. Boss text / scratchpad -->
        <div class="field" style="margin-bottom:0.75rem;">
          <label for="raw-text">Paste job text from boss (optional)</label>
          <textarea id="raw-text" placeholder="e.g. MAGIC Con – 11/12 – 8am–5pm – Booth 4012 – LVCC West Hall"></textarea>

          <div class="center-btn" style="margin-top:0.5rem;">
            <button id="ai-fill-btn" class="primary small">
              Smart Fill
            </button>
          </div>
          <div id="auto-fill-warnings" class="muted" style="margin-top:0.3rem; text-align:center; font-size:0.85rem;"></div>
          <div id="shift-selector" class="shift-selector" style="display:none;">
            <span class="shift-selector-label">Multiple shifts detected. This job is:</span>
            <div class="shift-pill-row">
              <button type="button" class="shift-pill" data-shift-key="setup">Setup</button>
              <button type="button" class="shift-pill" data-shift-key="show">Show</button>
              <button type="button" class="shift-pill" data-shift-key="strike">Strike</button>
            </div>
          </div>
        </div>

        <!-- INNER original body -->
        <div id="add-job-body">
          <!-- 1. Job basics -->
          <div class="grid">
            <div class="field">
              <label for="job-name">Job / Event Name</label>
              <input id="job-name" placeholder="MAGIC Con – Setup" />
            </div>
            <div class="field">
              <label for="job-date">Date</label>
              <input id="job-date" type="date" />
            </div>
          </div>

          <!-- 2. Time & location -->
          <div class="grid" style="margin-top: 0.75rem;">
            <div class="field">
              <label for="job-start">Start Time</label>
              <input id="job-start" type="time" />
            </div>
            <div class="field">
              <label for="job-end">End Time</label>
              <input id="job-end" type="time" />
            </div>
            <div class="field">
              <label for="job-booth">Booth #</label>
              <input id="job-booth" placeholder="4012" />
            </div>
            <div class="field">
              <label for="job-location">Location / Hall</label>
              <input id="job-location" placeholder="LVCC West Hall" />
            </div>
          </div>

          <!-- Job phase -->
          <div class="field" style="margin-top: 0.75rem;">
            <label for="job-phase">Job type / phase</label>
            <select id="job-phase">
              <option value="">(not set)</option>
              <option value="Build">Build</option>
              <option value="Assist">Assist</option>
              <option value="Dismantle">Dismantle</option>
              <option value="Other">Other</option>
            </select>
            <p class="muted" style="margin:0.2rem 0 0;">
              This helps color-code jobs in the Upcoming / Completed views.
            </p>
          </div>

          <!-- Notes -->
          <div class="field" style="margin-top: 0.75rem;">
            <label for="job-notes">Notes</label>
            <textarea id="job-notes" placeholder="Park in silver lot, black shirt no logos, check in at door 3."></textarea>
          </div>

          <!-- Assign workers -->
          <div class="subsection-label" style="text-align:center;">Assign workers</div>

          <div class="field" style="margin-top:0.5rem;">
            <div id="toggle-inline-worker"
                 style="cursor:pointer; text-decoration:underline;
                        font-size:0.9rem; display:inline-flex;
                        align-items:center; gap:0.25rem; margin-bottom:0.5rem;">
              <span>+ Add New Worker</span>
            </div>

            <!-- inline form -->
            <div id="inline-worker-form" style="display:none; margin-bottom:0.6rem;">
              <div class="grid">
                <div class="field">
                  <label for="inline-worker-name">Name</label>
                  <input id="inline-worker-name" placeholder="e.g. Carlos M." />
                </div>
                <div class="field">
                  <label for="inline-worker-phone">Phone</label>
                  <input id="inline-worker-phone" placeholder="e.g. 702-555-1234" />
                </div>
              </div>

              <div class="center-btn" style="margin-top:0.5rem;">
                <button type="button" id="inline-add-worker-btn" class="small">
                  Add worker &amp; keep checked
                </button>
              </div>
            </div>

            <label style="display:none;">Assign workers to this job</label>
            <div id="assign-workers" class="assign-workers-list"></div>
          </div>

          <div class="center-btn">
            <button id="add-job-btn">Add Job + Send Invites</button>
          </div>

          <p id="job-message" class="muted" style="text-align:center; margin-top:0.35rem; min-height:1em;"></p>
        </div> <!-- end inner body -->
      </div> <!-- end full body wrapper -->
    </section>

    <!-- Upcoming Jobs (mini + full in ONE card) -->
    <section class="section" id="upcoming-jobs-section">
      <h2 id="upcoming-jobs-toggle" role="button" tabindex="0" aria-expanded="false" title="Show/Hide">
       
       <span class="icon-wrap">
<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
  <circle cx="12" cy="12" r="10" stroke="#d1d5db" fill="white"/>
  <path d="M10 12.5l1.5 1.5 3-3"/>
  <rect x="9" y="8" width="6" height="8" rx="1"/>
</svg>
</span>

        <span>Upcoming Jobs</span>
        <span class="caret" aria-hidden="true">▸</span>
      </h2>

      <div id="upcoming-jobs-body" style="display:none; margin-top:0.5rem;">
        <p>Next 5 upcoming jobs.</p>

        <!-- Mini list: next 5 jobs -->
        <div id="next-jobs"></div>

        <!-- Full future jobs list (hidden by default) -->
        <div id="upcoming-jobs-full" style="display:none; margin-top:0.75rem;">
          <p class="muted" style="margin-bottom:0.35rem;">
            Upcoming jobs, grouped by month. Tap a job row to see full details, worker statuses, and delete.
          </p>
          <p class="muted" style="font-size:0.78rem; margin-top:.2rem;">
            Status key: <strong>C</strong> = Confirmed, <strong>I</strong> = Invited, <strong>D</strong> = Declined
          </p>

          <div id="jobs-upcoming-table" class="scroll-x"><!-- upcoming month groups injected --></div>
        </div>

        <!-- Button that toggles the full list -->
        <div class="see-all-wrapper">
          <button id="upcoming-see-all-btn" class="see-all-link" aria-expanded="false">
            <span class="label">See all future jobs</span>
            <span class="caret" aria-hidden="true">▸</span>
          </button>
        </div>
      </div>
    </section>



    <!-- Finalize Job (HHR Flow) -->
     
    <section class="section" id="finalize-section">
      <h2 id="finalize-toggle" role="button" tabindex="0" aria-expanded="false" title="Show/Hide">
       <span class="icon-wrap">
        
<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
  <circle cx="12" cy="12" r="10" stroke="#d1d5db" fill="white"/>
  <line x1="12" y1="12" x2="12" y2="8"/>
  <line x1="12" y1="12" x2="15" y2="12"/>
</svg>
</span>

        <span>Finalize Job</span>
        <span class="caret" aria-hidden="true">▸</span>
      </h2>

      <div id="finalize-body" style="display:none; margin-top:0.5rem;">
        <p class="muted">
          Close out jobs here: confirm who actually worked, tweak hours, generate a clean report, then mark it completed.
        </p>

        <!-- Step 1: pick job -->
        <div class="field">
          <label for="finalize-job-select">1. Choose a job to finalize</label>
          <select id="finalize-job-select">
            <option value="">Select a job…</option>
            <!-- options injected -->
          </select>
          <p class="muted" style="font-size:0.8rem; margin-top:0.25rem;">
            Only jobs with dates today or in the past (and not yet marked completed) will show here.
          </p>
        </div>

        <!-- Step 2: worker hours -->
        <div class="field">
          <label>2. Review workers &amp; hours</label>
          <div id="finalize-workers-container" class="scroll-x muted" style="font-size:0.85rem;">
            Select a job above to see assigned workers and enter actual hours.
          </div>
        </div>

        <!-- Step 3: reporting text -->
        <div class="field">
          <label for="finalize-notes">3. Add notes for your bookkeeper (optional)</label>
          <textarea
            id="finalize-notes"
            placeholder="e.g. John stayed 2 extra hours, client approved overtime."
          ></textarea>

          <!-- Inline links under the text box -->
          <div style="margin-top:0.35rem; font-size:0.85rem;">
            <span
              id="finalize-voice-link"
              style="text-decoration:underline; cursor:not-allowed; opacity:0.6; margin-right:0.75rem;"
              title="Voice note parsing coming soon"
            >
              Upload voice note (soon)
            </span>

            <span
              id="finalize-download-link"
              style="text-decoration:underline; cursor:pointer;"
              title="Download this report as CSV"
            >
              Download CSV
            </span>
            <span
              id="finalize-rebuild-link"
              style="text-decoration:underline; cursor:pointer; margin-left:0.75rem;"
              title="Rebuild notes from the hours table"
            >
              Rebuild from table
            </span>
          </div>
        </div>

        <!-- Copy button -->
        <div class="center-btn" style="margin-top:0.75rem;">
          <button id="finalize-export-btn" class="secondary small" disabled>
            Copy report text
          </button>
        </div>

        <!-- Actions -->
        <div class="center-btn" style="margin-top:0.5rem;">
          <button id="finalize-complete-btn" class="small" disabled>
            Mark report complete &amp; move to Completed
          </button>
        </div>
      </div>
    </section>

    <!-- Completed Jobs (past) -->
    <section class="section" id="completed-jobs-section">
      <h2 id="completed-jobs-toggle" role="button" tabindex="0" aria-expanded="false" title="Show/Hide">
       
       <span class="icon-wrap">
  <svg width="22" height="22" viewBox="0 0 24 24" fill="none"
       stroke="#4b5563" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
    <!-- outer circle -->
    <circle cx="12" cy="12" r="10" stroke="#d1d5db" fill="white" />
    <!-- gear outer shape -->
    <path d="M12 8.2a3.8 3.8 0 1 0 0 7.6 3.8 3.8 0 0 0 0-7.6z" fill="none" />
    <!-- gear teeth -->
    <path d="M12 5.3v1.4" />
    <path d="M12 17.3v1.4" />
    <path d="M7.3 12H5.9" />
    <path d="M18.1 12h-1.4" />
    <path d="M8.5 8.5l-1-1" />
    <path d="M16.5 16.5l-1-1" />
    <path d="M15.5 8.5l1-1" />
    <path d="M7.5 16.5l1-1" />
  </svg>
</span>

        <span>Completed Jobs</span>
        <span class="caret" aria-hidden="true">▸</span>
      </h2>

      <div id="completed-jobs-body" style="display:none; margin-top:0.5rem;">
        <p class="muted">
          Past jobs, grouped by month. Tap a job row to see details, worker statuses, and delete.
        </p>
        <div id="jobs-completed-table" class="scroll-x"><!-- completed month groups injected --></div>
      </div>
    </section>

    <!-- Workers (Management) – moved BELOW Completed -->
    <section class="section" id="workers-section">
      <h2 id="workers-toggle" role="button" tabindex="0" aria-expanded="false" title="Show/Hide workers">
       
        <span class="icon-wrap">
  <svg width="22" height="22" viewBox="0 0 24 24" fill="none"
       stroke="#4b5563" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
    <!-- outer circle -->
    <circle cx="12" cy="12" r="10" stroke="#d1d5db" fill="white" />
    <!-- helmet dome -->
    <path d="M7.5 13.2C7.7 10.6 9.4 9 12 9c2.6 0 4.3 1.6 4.5 4.2" />
    <!-- center ridge -->
    <path d="M12 9V7.5" />
    <!-- brim -->
    <path d="M6.5 13.5h11" />
    <!-- side strap hint -->
    <path d="M8.5 13.5v1.2a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1v-1.2" />
  </svg>
</span>

        <span>Workers</span>
        <span class="caret" aria-hidden="true">▸</span>
      </h2>

      <div id="workers-body" style="display:none; margin-top:0.5rem;">
        <p>Add your crew here. Each worker gets a unique ID and a personal link to their schedule.</p>
        <p class="muted" id="workers-cloud-status" style="font-size:0.78rem; margin-top:0.1rem;"></p>

        <div class="grid workers-grid">
          <div class="field">
            <label for="worker-name">Name</label>
            <input id="worker-name" placeholder="e.g. Carlos M." />
          </div>
          <div class="field">
            <label for="worker-phone">Phone (optional)</label>
            <input id="worker-phone" placeholder="e.g. 702-555-1234" />
          </div>
        </div>

        <div class="center-btn">
          <button id="add-worker-btn">Add New Worker</button>
        </div>

        <div id="workers-list" style="margin-top:0.75rem; display:none;">
          <p class="muted" style="margin-bottom:0.4rem;">
            Click a link field to select; long-press to copy on mobile.
          </p>
          <div class="scroll-x">
            <table class="table" id="workers-table"><!-- rows injected --></table>
          </div>
        </div>
      </div>
    </section>

    <!-- Dev / Sandbox tools (local only) -->
    <section class="section" id="dev-tools-section">
      <h2 style="display:flex; align-items:center; gap:0.4rem; font-size:1rem;">
        <span>Dev / Sandbox tools</span>
        <span class="muted" style="font-size:0.75rem;">(local only)</span>
      </h2>

      <p class="muted" style="font-size:0.8rem; margin-bottom:0.5rem;">
        These buttons are for testing only. They seed fake workers/jobs and clear everything in
        Supabase + local storage. Don’t use in production.
      </p>

      <div class="grid" style="row-gap:0.5rem;">
        <button id="generate-sample-jobs-btn" class="small">
          Generate sample jobs (20)
        </button>
        <button id="generate-finalizable-jobs-btn" class="small">
          Generate 3 finalizable jobs
        </button>
        <button id="seed-test-data-btn" class="small">
          Seed quick test worker + job
        </button>
        <button id="reset-app-data-btn" class="small" style="background:#fee2e2; color:#991b1b;">
          ⚠️ Reset ALL data (local + Supabase)
        </button>
      </div>
    </section>

    <!-- Safety & Backup footer -->
    <div style="margin-top:1.5rem; padding:0.75rem 0 1.5rem; border-top:1px dashed rgba(255, 237, 213, 0.7); text-align:center;">
      <p style="margin:0 0 0.35rem; font-size:0.8rem; letter-spacing:0.12em; text-transform:uppercase; color:#ffedd5;">
        Safety &amp; Backup
      </p>

      <div style="display:flex; justify-content:center; align-items:center; flex-wrap:wrap; gap:1.25rem; margin-bottom:0.25rem;">
        <span id="backup-download-link" style="font-size:0.85rem; color:#fef3c7; cursor:pointer; text-decoration:underline;">
          ⬇️ Download backup (save a copy)
        </span>
        <span id="backup-restore-link" style="font-size:0.85rem; color:#dcfce7; cursor:pointer; text-decoration:underline;">
          ⬆️ Restore from backup file
        </span>
      </div>

      <p id="backup-status" style="margin:0; font-size:0.8rem; color:#fed7aa;">
        Tip: After big schedule changes, download a backup so you can restore this on any browser.
      </p>

      <input type="file" id="backup-file-input" accept="application/json,.json" style="display:none;" />
    </div>
  </div>
</body>
<p class="muted"
   style="font-size:0.8rem; margin-top:0.1rem; text-align:center; width:100%;">
  <a href="legal.html" target="_blank">Privacy &amp; SMS Policy</a> ·
  <a href="terms.html" target="_blank">Terms of Service</a>
</p>


</html>
